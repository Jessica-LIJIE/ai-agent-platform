# 🤖 智能体创作平台需求分析

# 📕 1. 项目概述
本项目旨在构建智能体创作平台，实现可视化 AI 智能体编辑、知识库构建、插件系统、可插拔模型、多角色权限等能力，涵盖从用户登录、工作流设计到智能体运行的一整套工具链，实现一个面向开发者与普通用户均可使用的 AI Agent 平台。

---

## 🎯 学习目标
通过本项目，你将学会开发一个智能体创作平台，掌握：
- 前端可视化编辑器开发（Vue 3 + TypeScript + Element Plus 现代前端开发）
- Spring Boot 后端开发与架构分层（SpringBoot + MyBatis Plus 企业级Java开发）
- 数据库构建 MySQL（关系型数据库）+ Redis（缓存）+ 向量数据库（NoSQL）
- 文档解析、文本切片等知识库构建技术
- 向量数据库与 RAG 检索增强技术
- 插件系统与 OpenAPI 3.0 标准
- 外部大模型 API 调用（DeepSeek/豆包/通义千问）
- RESTful API 设计
- 单元测试、集成测试与前后端联调
- Docker 一键部署

---

## 🏗️ 最终系统架构
你将要构建的系统包含：
- 前端：Vue 3 + TypeScript + Element Plus 
- 后端：SpringBoot + MyBatis Plus +JWT认证  
- 数据库：MySQL（结构化数据）、Redis（缓存）、NoSQL（向量数据） 
- API：RESTful接口，统一响应格式
- 向量库：Chroma 或 Milvus  
- 模型服务：外部 API（DeepSeek/通义千问等）  
- 插件系统：基于 OpenAPI 3.0 的可插拔扩展  
- 部署/测试：Docker + 自动化测试体系  

---

## 📊 预期成果
完成后的系统将包含：
- 用户管理: 支持注册、登录、个人信息管理
- 角色系统: 2种用户角色，灵活的权限分配
- 智能体管理：创建、查看、编辑、测试、发布智能体、智能体对话 
- 知识库管理：创建知识库、支持 TXT/Markdown 文档上传、查看文档、自动向量化、RAG 检索  
- 工作流管理：创建、配置参数、执行流程、可视化拖拽节点
- 插件管理：注册、启用/禁用、外部 API 调用  
- 多模型支持：统一模型调用接口  
- 一键部署：使用 Docker Compose 完成环境初始化  
- 完整文档体系：需求文档、接口文档、部署文档、测试文档  

---

# 👥 2. 用户角色设计

## 🟡 用户（User）
- 权限: 个人信息管理、基础功能使用
- 职责: 系统的基础使用者
- 使用场景:
  - 创建、调试、发布、执行智能体  
  - 知识库创建、文档上传、检索
  - 创建、调试工作流 
  - 使用已启用的插件

## 🟢 管理员（Admin）
- 权限: 系统所有功能的完全访问权限
- 职责: 系统初始化、日常系统管理和维护、全局配置管理、紧急问题处理
- 使用场景：
  - 智能体管理
  - 知识库管理
  - 工作流管理
  - 插件源管理
  - 系统监控与故障处理

---

## 🚀 3. 核心功能需求
# 🚀 3. 核心功能需求

## 1️⃣ 智能体管理模块

### 📝 创建智能体功能
**用户故事：**  
作为一个用户，我希望能够创建一个新的智能体，以便使用 AI 助手完成自定义任务。

**功能要求：**
- 支持填写智能体名称、描述
- 支持选择绑定的工作流与知识库
- 必填项校验（名称必填）
- 创建成功后写入数据库
- 创建后的智能体应展示在智能体列表中

**验收标准：**
- ✅ 用户填写完整信息后可以成功创建智能体
- ✅ 系统校验必填项，缺失时给出明确提示
- ✅ 智能体成功保存到数据库
- ✅ 新建智能体在列表页面可见

---

### 📄 查看智能体列表功能
**用户故事：**  
作为一个用户，我希望查看我创建的所有智能体列表，以便管理和选择要使用的智能体。

**功能要求：**
- 显示用户创建的所有智能体
- 显示名称、描述、状态、更新时间等基本字段
- 列表加载失败时需提示用户

**验收标准：**
- ✅ 系统成功展示用户创建的智能体列表
- ✅ 列表信息包含名称、描述、状态、更新时间
- ✅ 展示的数据为用户最新保存的内容
- ✅ 加载失败时显示明确错误提示

---

### ✏️ 编辑智能体功能
**用户故事：**  
作为一个用户，我希望能够编辑已创建的智能体，以便更新其提示词与配置，使其保持最佳效果。

**功能要求：**
- 支持编辑名称、描述、提示词
- 支持重新绑定知识库或工作流
- 保存时校验字段合法性
- 编辑成功后更新智能体修改时间

**验收标准：**
- ✅ 用户可进入智能体编辑页面并查看当前配置
- ✅ 编辑后点击保存可成功更新内容
- ✅ 再次进入编辑页面显示最新保存的数据
- ✅ 编辑保存失败时显示明确错误提示

---

### 🧪 测试智能体功能
**用户故事：**  
作为一个用户，我希望能够测试智能体，以便验证配置、提示词与流程是否正常工作。

**功能要求：**
- 提供测试输入框与测试历史
- 根据智能体配置执行模型、RAG 检索或工作流
- 展示执行成功或失败的完整结果

**验收标准：**
- ✅ 用户可正常进入智能体测试界面
- ✅ 输入问题后能执行智能体并显示结果
- ✅ 执行失败时系统提示清晰错误原因
- ✅ 执行成功时展示完整模型回答或工作流输出

---

### 🗑️ 删除智能体功能
**用户故事：**  
作为一个用户，我希望删除自己已创建的智能体，以便清理不再需要的内容。

**功能要求：**
- 仅允许删除当前用户自己创建的智能体
- 删除前需二次确认
- 删除后智能体从列表消失
- 删除失败时显示详细错误原因
- 删除时不影响知识库与工作流，仅解除绑定

**验收标准：**
- ✅ 系统仅允许用户删除自己的智能体
- ✅ 删除前系统显示删除确认提示（不可恢复）
- ✅ 删除成功后智能体从列表中移除并提示成功
- ✅ 删除失败时显示明确错误提示
- ✅ 删除智能体不会删除知识库与工作流，仅解除关联

---

## 2️⃣ 知识库管理模块

### 📝 创建知识库功能
**用户故事：**  
作为一个用户，我想要创建一个新的知识库，以便存储和管理文档资料，为智能体提供知识来源。

**功能要求：**
- 支持填写知识库名称、描述
- 名称为必填项
- 创建成功后写入数据库
- 新知识库应显示在知识库列表中
- 创建失败时需要明确提示原因

**验收标准：**
- ✅ 用户填写名称与描述后可成功创建知识库
- ✅ 系统校验名称必填，未填写时提示“名称不能为空”
- ✅ 知识库成功写入数据库
- ✅ 新建知识库在列表页面可见
- ✅ 后端异常时系统提示“创建失败”及原因

---

### 📁 上传文档并构建向量功能
**用户故事：**  
作为一个用户，我想要上传 TXT 或 Markdown 文档到知识库，以便构建知识库并支持 RAG 检索。

**功能要求：**
- 支持上传 TXT 或 Markdown 格式文件
- 支持大小限制验证
- 不支持格式需提示错误
- 支持后台文档分块与向量化处理
- 文档需展示处理状态（处理中 / 已完成 / 失败）

**验收标准：**
- ✅ TXT / Markdown 文件上传成功
- ✅ 文件超出大小限制时提示“文件大小超出限制”
- ✅ 非支持格式（PDF、DOCX 等）提示“文件格式不支持”
- ✅ 文档上传后后台自动分块与向量化
- ✅ 文档处理状态可在列表中查看

---

### 📄 查看知识库文档功能
**用户故事：**  
作为一个用户，我想要查看知识库中的文档列表，以便了解当前知识库的内容与处理状态。

**功能要求：**
- 支持展示某个知识库下的所有文档
- 显示文件名、上传时间、处理状态
- 空列表时需显示“暂无文档”
- 分块/向量化处理中需实时展示状态变化

**验收标准：**
- ✅ 页面展示知识库下所有文档的列表信息
- ✅ 文档信息包含文件名、上传时间、处理状态
- ✅ 知识库为空时显示“暂无文档”提示
- ✅ 刷新页面后可看到文档最新处理状态（处理中 → 完成/失败）

---

### 🔎 RAG 检索功能
**用户故事：**  
作为一个用户，我想要基于知识库执行 RAG 检索，以便获取与问题最相关的文档内容。

**功能要求：**
- 支持选择知识库并输入问题
- 执行向量相似度检索
- 返回相关文档片段、相似度
- 无结果时需提示
- 检索延迟需在可接受范围（约 300ms）
- 错误需明确提示

**验收标准：**
- ✅ 用户输入问题并点击“检索”后可执行 RAG 查询
- ✅ 系统返回相似度最高的文档片段与评分
- ✅ 无匹配结果时提示“未检索到相关内容”
- ✅ 正常系统负载下检索延迟约为 300ms
- ✅ RAG 服务或向量服务异常时提示“检索失败”及原因

---

### 🗑️ 删除知识库功能
**用户故事：**  
作为一个用户，我想要删除已创建的知识库，以便移除不再需要的知识库，保持资源整洁。

**功能要求：**
- 仅可删除用户自己创建的知识库
- 删除前需展示不可恢复的确认提示
- 删除时需一并删除文档与向量数据
- 若知识库被智能体使用需阻止删除
- 删除失败需返回明确原因

**验收标准：**
- ✅ 用户仅能删除自己创建的知识库
- ✅ 删除前弹出“删除后不可恢复”确认提示
- ✅ 删除成功后知识库与其下文档、向量全部被移除
- ✅ 删除失败时提示明确错误原因
- ✅ 知识库被智能体引用时阻止删除并提示原因（如“该知识库正在被 X 个智能体使用”）

---

## 3️⃣ 工作流管理模块

### 📝 创建工作流功能
**用户故事：**  
作为一个用户，我想要通过可视化拖拽节点创建工作流，以便直观地定义智能体的执行流程。

**功能要求：**
- 支持拖拽添加 Start、LLM、Condition、Plugin、Output 等节点
- 支持拖拽连线形成节点流程关系
- 支持删除节点与连线
- 支持编辑节点参数（模型参数、插件参数、分支条件等）
- 保存时需进行 DAG 合法性校验（无环、节点配置正确）
- 保存成功后将工作流持久化

**验收标准：**
- ✅ 拖拽节点后可在画布中展示对应节点
- ✅ 连线成功后节点关系得到正确更新
- ✅ 删除节点或连线后画布结构即时更新
- ✅ 编辑节点参数后成功保存到工作流结构中
- ✅ 工作流保存时通过 DAG 校验并成功持久化
- ✅ 校验失败时显示“流程结构存在循环或错误”

---

### ▶️ 执行完整工作流功能
**用户故事：**  
作为一个用户，我想要执行整个工作流，以便查看最终的执行效果。

**功能要求：**
- 支持从 Start 节点开始顺序执行所有节点
- 节点执行成功后可查看最终输出
- 节点执行失败时需中断并提示失败节点与原因
- 可在执行过程中查看节点执行状态：pending / running / completed / failed

**验收标准：**
- ✅ 用户点击“执行工作流”后系统从 Start 节点依序执行
- ✅ 所有节点执行成功时展示 Output 节点最终输出
- ✅ 某节点失败时中断执行并提示失败节点与原因
- ✅ 执行过程中可查看节点执行状态更新

---

### 🧪 调试单个节点功能
**用户故事：**  
作为一个用户，我想要单独调试某个节点，以便在复杂工作流中快速定位问题。

**功能要求：**
- 支持选中任意节点并进入节点调试模式
- 支持填写或使用示例输入调试节点
- 节点调试结果需单独展示
- 节点调试不得影响正式工作流配置

**验收标准：**
- ✅ 用户可选择任意节点进入调试模式
- ✅ 用户输入参数后可单独执行该节点
- ✅ 系统展示该节点执行输出
- ✅ 单节点调试不会修改正式工作流配置

---

## 4️⃣ 插件管理模块

### 📝 注册插件功能
**用户故事：**  
作为一个用户，我想要注册一个自定义插件，以便扩展智能体的功能。

**功能要求：**
- 支持输入 OpenAPI URL 或上传 OpenAPI JSON 文件
- 支持解析并展示接口列表
- 支持填写插件名称、描述、鉴权信息
- 格式错误需提示
- 注册成功后插件显示在插件列表中

**验收标准：**
- ✅ 用户提交 OpenAPI 后系统可成功读取并解析
- ✅ OpenAPI 格式正确时显示接口信息并允许填写插件详情
- ✅ OpenAPI 格式错误时提示明确错误信息
- ✅ 保存插件后返回插件列表并正常可见

---

### 🔄 启用 / 禁用插件功能
**用户故事：**  
作为一个用户，我想要启用或禁用已注册的插件，以便控制它们是否可以在工作流中使用。

**功能要求：**
- 支持切换插件启用/禁用状态
- 禁用插件不得在工作流编辑器中出现
- 启用插件后可在工作流中正常选择与使用

**验收标准：**
- ✅ 用户可在插件管理界面切换启用/禁用状态
- ✅ 插件禁用后在工作流中不可选择
- ✅ 插件启用后在工作流中可选择并正常使用

---

### 🧲 调用插件功能
**用户故事：**  
作为一个用户，我想要在工作流中调用插件，以便扩展智能体的能力并调用外部 API。

**功能要求：**
- 插件节点可绑定已启用的插件接口
- 插件调用成功需输出结果并传递给后续节点
- 插件调用失败需返回明确错误并中断流程

**验收标准：**
- ✅ 工作流中插件节点可成功绑定插件接口
- ✅ 插件调用成功时返回结果并显示在最终输出中
- ✅ 插件调用失败时提示错误原因并终止执行

---

## 5️⃣ 综合功能模块

### 🚀 发布智能体功能
**用户故事：**  
作为一个用户，我想要发布已创建的智能体，以便让智能体可以被正式使用。

**功能要求：**
- 仅允许发布状态为 draft 的智能体
- 发布前系统需校验智能体配置完整性
- 配置不完整需提示缺失内容
- 发布成功后将智能体状态更新为 published

**验收标准：**
- ✅ 用户点击“发布”后开始执行配置验证
- ✅ 配置缺失时提示缺少项并阻止发布
- ✅ 配置完整时可成功发布并更新为 published
- ✅ 发布成功后页面跳转并提示“发布成功”

---

### 💬 智能体对话功能
**用户故事：**  
作为一个用户，我想要与已发布的智能体进行对话，以便获得 AI 助手提供的回答与帮助。

**功能要求：**
- 仅允许对话状态为 published 的智能体
- 对话界面需展示输入框与历史消息
- 根据智能体配置执行模型推理、RAG 检索或工作流
- 回复成功时展示回答
- 执行失败时展示错误原因

**验收标准：**
- ✅ 进入已发布智能体的对话界面可看到输入框与历史记录
- ✅ 提问后系统根据配置执行模型/RAG/工作流
- ✅ 执行成功时显示最终回答
- ✅ 执行失败时提供明确错误提示（如模型失败、工作流节点错误、RAG 超时）

---

## 6️⃣ 用户管理模块

### 📝 用户注册功能
**用户故事：**  
作为一个用户，我想要注册一个新账号，以便使用系统全部功能。

**功能要求：**
- 支持用户名 + 邮箱 + 密码注册
- 校验邮箱格式、唯一性、密码强度
- 注册成功后创建用户并发送验证邮件
- 注册失败需提示具体原因

**验收标准：**
- ✅ 邮箱格式、唯一性、密码强度均需通过验证
- ✅ 注册信息合法时创建账号并发送邮箱验证链接
- ✅ 信息不合法时提示具体错误原因

---

### 🔐 用户登录功能
**用户故事：**  
作为一个用户，我想要登录系统，以便访问个人账号和功能。

**功能要求：**
- 支持邮箱/用户名 + 密码登录
- 登录成功后跳转首页
- 登录失败时展示错误信息
- 多次失败后需临时锁定账号

**验收标准：**
- ✅ 正确输入邮箱/用户名与密码可登录并进入首页
- ✅ 账号或密码错误时展示“账号或密码错误”
- ✅ 登录失败达到上限（如 5 次）后账户被临时锁定

---

### ✏️ 编辑个人资料功能
**用户故事：**  
作为一个用户，我想要查看与修改个人资料，以便保持账号信息准确。

**功能要求：**
- 支持查看个人信息（昵称、邮箱、头像等）
- 支持编辑昵称、头像、简介
- 支持修改密码（需验证旧密码）
- 修改成功需保存最新信息

**验收标准：**
- ✅ 用户可查看昵称、邮箱、头像等信息
- ✅ 编辑资料并保存后系统成功更新
- ✅ 输入旧密码及新密码后可成功修改密码

---

## 7️⃣ 系统管理模块

### ⚙️ 配置模型与系统参数功能
**用户故事：**  
作为一个管理员，我想要配置系统关键参数（如模型 API Key），以便系统正常运行。

**功能要求：**
- 可新增、编辑、删除模型配置
- 包含 API Key、模型名称、可用性等字段
- 修改后需立即保存
- 修改结果需在模型列表中展示

**验收标准：**
- ✅ 管理员可新增/编辑/删除模型配置并成功保存
- ✅ 返回模型列表时展示最新的模型配置信息

---

### 📄 查看系统日志功能
**用户故事：**  
作为一个管理员，我想要查看系统运行日志，以便在出现问题时快速定位原因。

**功能要求：**
- 支持选择时间范围查询日志
- 支持按模块（插件调用、智能体执行等）进行过滤或搜索
- 支持日志导出下载（如 CSV）

**验收标准：**
- ✅ 管理员选择时间范围时可加载对应日志
- ✅ 搜索或筛选可显示符合条件的日志记录
- ✅ 点击导出后可下载标准格式日志文件（CSV）

---

# 📚 4. API 设计（概要）

## 🧩 用户鉴权模块 Auth

| 模块 | 方法 | URL |
|------|--------|--------|
| 用户鉴权 | POST | /api/v1/auth/register |
| 用户鉴权 | POST | /api/v1/auth/login |

---

## 👤 用户模块 User

| 模块 | 方法 | URL |
|------|--------|--------|
| 用户 | GET | /api/v1/users/me |
| 用户 | PUT | /api/v1/users/me |
| 用户 | PUT | /api/v1/users/me/password |

---

## 🤖 智能体模块 Agent

| 模块 | 方法 | URL |
|------|--------|--------|
| 智能体 | POST | /api/v1/agents |
| 智能体 | GET | /api/v1/agents |
| 智能体 | GET | /api/v1/agents/{agentId} |
| 智能体 | PUT | /api/v1/agents/{agentId} |
| 智能体 | DELETE | /api/v1/agents/{agentId} |
| 智能体 | POST | /api/v1/agents/{agentId}/publish |
| 智能体 | POST | /api/v1/agents/{agentId}/test |
| 智能体 | POST | /api/v1/agents/{agentId}/chat |

---

## 📚 知识库模块 Knowledge Base

| 模块 | 方法 | URL |
|------|--------|--------|
| 知识库 | POST | /api/v1/knowledge-bases |
| 知识库 | GET | /api/v1/knowledge-bases |
| 知识库 | GET | /api/v1/knowledge-bases/{kbId} |
| 知识库 | DELETE | /api/v1/knowledge-bases/{kbId} |
| 文档上传 | POST | /api/v1/knowledge-bases/{kbId}/documents/upload |
| 知识库文档 | GET | /api/v1/knowledge-bases/{kbId}/documents |
| 知识检索 | POST | /api/v1/knowledge-bases/{kbId}/search |

---

## 🔧 工作流模块 Workflow

| 模块 | 方法 | URL |
|------|--------|--------|
| 工作流 | POST | /api/v1/workflows |
| 工作流 | PUT | /api/v1/workflows/{workflowId} |
| 工作流 | GET | /api/v1/workflows |
| 工作流 | GET | /api/v1/workflows/{workflowId} |
| 工作流执行 | POST | /api/v1/workflows/{workflowId}/execute |
| 单节点调试 | POST | /api/v1/workflows/{workflowId}/nodes/{nodeId}/debug |

---

## 🔌 插件模块 Plugin

| 模块 | 方法 | URL |
|------|--------|--------|
| OpenAPI 解析 | POST | /api/v1/plugins/parse-openapi |
| 插件注册 | POST | /api/v1/plugins |
| 插件列表 | GET | /api/v1/plugins |
| 插件详情 | GET | /api/v1/plugins/{pluginId} |
| 插件状态切换 | PATCH | /api/v1/plugins/{pluginId}/status |
| 插件接口列表 | GET | /api/v1/plugins/{pluginId}/operations |

---

## ⚙️ 系统配置 System Config

| 模块 | 方法 | URL |
|------|--------|--------|
| 系统配置获取 | GET | /api/v1/system/config |
| 模型列表更新 | PUT | /api/v1/system/models |

---

## 📝 系统日志 System Log

| 模块 | 方法 | URL |
|------|--------|--------|
| 查看日志 | GET | /api/v1/system/logs |
| 导出日志 | GET | /api/v1/system/logs/export |

---

# 📘 5. 用户故事（User Stories）

## 🤖 智能体管理模块

---

### US-001：创建智能体（P0）
**作为** 一个用户  
**我想要** 创建一个新的智能体  
**以便于** 使用AI助手完成自定义任务  

#### ✔ 验收标准 (Acceptance Criteria)：

##### AC1：创建智能体
- Given 用户已打开创建智能体页面  
- When 用户填写智能体名称、描述、选择绑定的工作流与知识库并提交  
- Then 系统创建智能体并保存到数据库，返回创建成功的智能体信息  

##### AC2：错误提示
- Given 用户未填写必填项  
- When 用户点击提交  
- Then 系统提示缺失项并阻止创建  

##### AC3：成功提示
- Given 创建成功  
- When 用户返回智能体列表  
- Then 新建的智能体会显示在列表中  

---

### US-002：查看智能体列表（P0）
**作为** 一个用户  
**我想要** 查看我创建的所有智能体列表  
**以便于** 管理和选择要使用的智能体  

#### ✔ 验收标准：

##### AC1：加载列表
- Given 用户已登录系统  
- When 用户访问智能体列表页面  
- Then 系统显示该用户创建的所有智能体  
- And 包含名称、描述、状态、更新时间等基本信息  

##### AC2：错误提示
- Given 系统无法加载列表（网络异常、后端错误）  
- When 用户打开智能体列表页面  
- Then 系统明确提示错误信息  

##### AC3：成功提示
- Given 用户之前创建过智能体并已保存  
- When 系统加载列表  
- Then 数据应为最新保存内容  

---

### US-003：编辑智能体（P0）
**作为** 一个普用户  
**我想要** 编辑已创建的智能体信息  
**以便于** 更新智能体的配置与提示词，使其保持最佳效果  

#### ✔ 验收标准：

##### AC1：进入编辑页面
- Given 用户已登录且该智能体属于该用户  
- When 用户进入智能体编辑页面  
- Then 系统加载智能体当前配置（名称、描述、提示词、绑定的知识库、绑定的工作流等）  

##### AC2：编辑并保存成功
- Given 用户修改名称、描述、提示词或绑定资源  
- When 用户点击保存  
- Then 系统保存更新的配置  
- And 更新智能体的修改时间  

##### AC3：再次打开依然正确
- Given 用户之前成功保存智能体更改  
- When 用户再次打开编辑页面  
- Then 系统显示最新保存的数据  

##### AC4：保存失败提示
- Given 编辑发生错误（如字段不合法、后台保存失败）  
- When 用户点击保存  
- Then 系统明确提示错误原因  

---

### US-004：测试智能体（P0）
**作为** 一个用户  
**我想要** 测试智能体的回答效果  
**以便于** 验证智能体的配置、提示词和工作流是否正确工作  

#### ✔ 验收标准：

##### AC1：进入测试界面
- Given 用户已创建智能体  
- When 用户进入智能体详情或测试页面  
- Then 系统展示测试输入框与测试历史（如有）  

##### AC2：执行智能体
- Given 用户输入测试问题  
- When 用户提交  
- Then 系统调用智能体绑定的工作流 / 模型配置执行  
- And 将执行过程的最终答案展示给用户  

##### AC3：执行失败
- Given 执行失败（如模型调用失败、工作流错误）  
- When 系统返回结果  
- Then 系统显示明确的失败原因  

##### AC4：执行成功
- Given 系统执行完成  
- When 返回结果  
- Then 界面展示完整的执行输出（模型回答、引用知识库、工作流产物等）  

---

### US-005：删除智能体（P0）
**作为** 一个用户  
**我想要** 删除我已创建的智能体  
**以便于** 移除不再使用或测试用的智能体，保持列表清晰  

#### ✔ 验收标准：

##### AC1：只能删除自己的智能体
- Given 用户已登录  
- And 系统中存在该用户创建的智能体  
- When 用户点击“删除”按钮  
- Then 系统允许删除操作  
- And 不允许删除其他用户创建的智能体  

##### AC2：删除前确认提示
- Given 用户点击删除按钮  
- When 系统弹出确认框  
- Then 用户必须确认一次  
- And 提示内容包含“删除后不可恢复”的警告  

##### AC3：删除成功
- Given 用户在确认框中点击“确认删除”  
- When 系统完成删除操作  
- Then 智能体从列表中移除  
- And 前端刷新为最新列表  
- And 系统提示“删除成功”  

##### AC4：删除失败提示
- Given 后端删除失败（如数据库错误、网络错误）  
- When 用户尝试删除  
- Then 系统提示明确错误原因  
- And 智能体仍保留在列表中  

##### AC5：级联影响检查
- Given 智能体绑定了知识库/工作流

## 📤 知识库管理模块

---

### US-006：创建知识库（P1）
**作为** 一个用户  
**我想要** 创建一个新的知识库  
**以便于** 存储和管理文档资料，为智能体提供知识来源  

#### ✔ 验收标准：

##### AC1：创建成功
- Given 一个用户已登录系统  
- When 用户填写知识库名称和描述并点击“创建”  
- Then 系统成功创建知识库并写入数据库  
- And 新知识库显示在知识库列表中  

##### AC2：必填项校验
- Given 用户未填写知识库名称（必填）  
- When 用户点击“创建”  
- Then 系统阻止创建并提示“名称不能为空”  

##### AC3：发生错误
- Given 后端创建知识库时出现错误（如数据库异常）  
- When 用户点击“创建”  
- Then 系统提示“创建失败”及原因说明  

---

### US-007：上传文档到知识库并构建向量（P0）
**作为** 一个用户  
**我想要** 上传 TXT 或 Markdown 文档到知识库  
**以便于** 构建知识库并支持 RAG 检索  

#### ✔ 验收标准：

##### AC1：上传格式正确
- Given 一个用户已创建知识库  
- When 用户选择 TXT 或 Markdown 文件并点击“上传”  
- Then 系统验证格式通过并接收文件  

##### AC2：文件过大
- Given 用户选择的文件超过系统大小限制  
- When 用户上传文件  
- Then 系统拒绝上传并提示“文件大小超出限制”  

##### AC3：格式错误
- Given 用户选择的文件不是 TXT 或 Markdown（如 PDF、DOCX）  
- When 用户上传  
- Then 系统拒绝并提示“文件格式不支持”  

##### AC4：文件处理（分块 + 向量化）
- Given 文档成功上传  
- When 系统后台处理文件  
- Then 文档被分块并向量化  
- And 文档状态从“处理中”更新为“已完成”或“失败”  

##### AC5：上传记录可见
- Given 文档处理已结束  
- When 用户进入该知识库的文档列表页面  
- Then 用户可以看到该文档的文件名、上传时间、处理状态  

---

### US-008：查看知识库文档（P1）
**作为** 一个用户  
**我想要** 查看知识库中的文档列表  
**以便于** 了解当前知识库的内容与处理状态  

#### ✔ 验收标准：

##### AC1：展示文档列表
- Given 一个用户已创建知识库  
- When 用户进入知识库详情页面  
- Then 系统显示该知识库下所有文档  
- And 展示文件名、上传时间、处理状态  

##### AC2：空列表情况
- Given 知识库中暂无任何文档  
- When 用户进入知识库详情页面  
- Then 系统显示“暂无文档”提示  
- And 引导用户上传文档  

##### AC3：处理状态更新
- Given 某些文档仍在处理中  
- When 用户刷新或重新进入页面  
- Then 系统展示最新的处理状态（如由处理中变为完成）  

---

### US-009：RAG 检索（P1）
**作为** 一个用户  
**我想要** 基于知识库执行 RAG 检索  
**以便于** 获取与问题最相关的文档内容  

#### ✔ 验收标准：

##### AC1：发起检索  
- Given 一个用户已有至少一个包含已处理文档的知识库  
- When 用户输入查询问题并点击“检索”  
- Then 系统对知识库向量进行相似度检索  

##### AC2：返回检索结果
- Given 检索有匹配内容  
- When 系统返回结果  
- Then 系统展示文档片段内容、所属文档、相似度评分  

##### AC3：无匹配
- Given 检索未找到足够相似内容  
- When 系统返回结果  
- Then 系统提示“未检索到相关内容”  

##### AC4：性能要求
- Given 系统处于正常负载下  
- When 用户发起检索  
- Then 检索结果应在约 300ms（或可接受时间）内返回  

##### AC5：错误处理
- Given RAG 服务或向量服务异常  
- When 用户点击“检索”  
- Then 系统提示“检索失败”及简要原因  

---

### US-010：删除知识库（P0）
**作为** 一个用户  
**我想要** 删除已创建的知识库  
**以便于** 移除不再需要的知识库，保持资源整洁  

#### ✔ 验收标准：

##### AC1：只能删除自己的知识库
- Given 一个用户已登录  
- And 该知识库由该用户创建  
- When 用户点击“删除知识库”按钮  
- Then 系统允许继续执行删除操作  

##### AC2：删除前确认提示
- Given 用户点击“删除知识库”  
- When 系统弹出确认框  
- Then 系统提示“删除后不可恢复，且文档与向量将被一起删除”  
- And 用户需要手动确认删除  

##### AC3：删除成功
- Given 用户在确认框内点击“确认删除”  
- When 系统执行删除逻辑  
- Then 系统删除该知识库  
- And 删除其下所有文档与对应向量  
- And 知识库立即从知识库列表中移除  
- And 系统提示“删除成功”  

##### AC4：删除失败提示
- Given 删除过程中出现后端错误（如数据库错误、向量库操作错误）  
- When 用户执行删除操作  
- Then 系统提示“删除失败”并显示简要原因  
- And 知识库保持原状，不被删除  

##### AC5：与智能体的绑定处理
- Given 知识库仍被一个或多个智能体绑定  
- When 用户尝试删除该知识库  
- Then 系统阻止删除  
- And 提示“该知识库正在被 X 个智能体使用，无法删除”  
- (Optional) 引导用户前往智能体管理中解除绑定  

## 🔧 工作流管理模块

---

### US-011：创建工作流（可视化拖拽编排）（P1）
**作为** 一个用户  
**我想要** 通过可视化拖拽节点创建工作流  
**以便于** 直观地定义智能体的执行流程  

#### ✔ 验收标准：

##### AC1：拖拽添加节点
- Given 一个用户已登录并打开工作流编辑画布  
- When 用户拖拽节点（如 Start、LLM、Condition、Plugin、Output）到画布  
- Then 系统在画布中显示对应节点  

##### AC2：节点连线
- Given 画布上已有多个节点  
- When 用户拖拽连线连接两个节点  
- Then 系统更新流程结构并显示连接关系  

##### AC3：节点或连线删除
- Given 用户选中一个节点或连线  
- When 用户执行删除操作  
- Then 系统立即更新流程结构并从画布移除该元素  

##### AC4：配置节点参数
- Given 用户点击任意节点  
- When 用户填写或修改该节点的参数（如 LLM 配置、插件参数、分支条件）  
- Then 系统保存该节点的配置到工作流结构中（暂存）  

##### AC5：保存工作流（含 DAG 验证）
- Given 用户已完成工作流编排  
- When 用户点击“保存工作流”  
- Then 系统校验流程合法性（包括 DAG 拓扑结构验证，不允许循环）  
- And 验证通过后工作流结构被持久化  
- And 若验证失败，则提示“流程结构存在循环或错误”  

---

### US-012：执行完整工作流（P1）
**作为** 一个用户  
**我想要** 执行整个工作流  
**以便于** 测试最终的执行效果  

#### ✔ 验收标准：

##### AC1：运行工作流
- Given 一个用户已创建并保存工作流  
- When 用户点击“执行工作流”  
- Then 系统按照工作流定义，从 Start 节点开始依序执行所有节点  

##### AC2：执行成功
- Given 所有节点均执行成功  
- When 工作流执行结束  
- Then 系统展示 Output 节点的最终输出结果  

##### AC3：节点执行失败
- Given 某个节点执行失败  
- When 工作流执行中断  
- Then 系统提示失败节点的名称  
- And 提示失败原因（如参数错误、模型调用失败、插件异常）  

##### AC4：查看执行状态
- Given 工作流正在执行  
- When 系统更新执行进度  
- Then 用户可看到 pending / running / completed / failed 等状态  

---

### US-013：调试单个节点（P1）
**作为** 一个用户  
**我想要** 单独调试某个节点  
**以便于** 在复杂工作流中快速定位问题  

#### ✔ 验收标准：

##### AC1：选择节点调试
- Given 用户在工作流编辑器中选中某个节点  
- When 点击“调试节点”  
- Then 系统展示节点所需输入参数（示例输入或用户自行输入）  

##### AC2：调试执行
- Given 用户填写调试输入  
- When 点击“开始调试”  
- Then 系统仅执行该节点的逻辑  
- And 展示该节点的输出结果  

##### AC3：不影响正式工作流配置
- Given 单节点调试已经完成  
- When 调试结束  
- Then 系统不会修改工作流正式配置  
- And 不会改变工作流整体的运行逻辑  

## 🔌 插件管理模块

---

### US-014：注册插件（P2）
**作为** 一个用户  
**我想要** 注册一个自定义插件  
**以便于** 扩展智能体的功能  

#### ✔ 验收标准：

##### AC1：输入 OpenAPI 规范地址（URL 或 JSON 文件）
- Given 一个用户已登录系统  
- When 用户输入 openapi.json URL 或上传 OpenAPI JSON 文件并点击“提交”  
- Then 系统读取 OpenAPI 内容并尝试解析 API 结构  

##### AC2：OpenAPI 格式正确
- Given OpenAPI 规范格式正确  
- When 系统解析成功  
- Then 系统展示 API 的基础信息与接口列表  
- And 用户可以填写插件名称、描述、鉴权配置等信息  

##### AC3：OpenAPI 格式错误
- Given OpenAPI 格式不正确或解析失败  
- When 用户提交解析  
- Then 系统提示“OpenAPI 格式错误”  

##### AC4：注册成功
- Given 用户已填写插件名称和描述  
- When 用户点击“保存插件”  
- Then 系统保存插件定义  
- And 返回插件管理页面  
- And 插件出现在插件列表中  

---

### US-015：启用 / 禁用插件（P2）
**作为** 一个用户  
**我想要** 启用或禁用已注册的插件  
**以便于** 控制插件是否可在工作流中使用  

#### ✔ 验收标准：

##### AC1：切换插件状态
- Given 一个用户已注册插件  
- When 用户在插件管理界面切换启用 / 禁用状态  
- Then 系统更新插件的启用状态  

##### AC2：禁用插件
- Given 插件处于禁用状态  
- When 用户在工作流编辑器中配置插件节点  
- Then 禁用的插件不会出现在可用插件接口列表中  

##### AC3：启用插件
- Given 插件处于启用状态  
- When 用户打开插件节点配置  
- Then 插件接口出现在可选列表中并可正常使用  

---

### US-016：在工作流中调用插件（P2）
**作为** 一个用户  
**我想要** 在工作流中调用插件  
**以便于** 扩展智能体的能力并调用外部 API  

#### ✔ 验收标准：

##### AC1：配置插件节点
- Given 用户在工作流编辑器中选择插件节点  
- When 用户从列表中选择一个已启用的插件接口  
- Then 系统将该节点绑定到插件接口定义  

##### AC2：插件调用成功
- Given 工作流执行到插件节点  
- When 插件 API 调用成功  
- Then 系统返回插件执行结果  
- And 节点输出可继续传入下游节点  
- And 若整个工作流执行完成  
- Then 插件结果体现在最终输出中  

##### AC3：插件调用失败
- Given 插件调用出现错误（如鉴权失败、超时、API 报错）  
- When 工作流执行该插件节点  
- Then 系统提示明确的错误原因  
- And 工作流执行失败并中断后续节点  

## 🧩 综合功能模块

---

### US-017：发布智能体（P2）
**作为** 一个用户  
**我想要** 发布已创建的智能体  
**以便于** 让智能体可以被正式使用  

#### ✔ 验收标准：

##### AC1：发布智能体
- Given 一个用户已创建一个智能体且其状态为 draft  
- When 用户点击“发布”按钮  
- Then 系统开始执行发布前的配置验证  

##### AC2：配置完整性校验
- Given 用户发起发布流程  
- When 系统检查智能体配置（如名称、提示词、模型配置、知识库、绑定工作流等）  
- Then 若配置完整 → 系统通过校验  
- And 若配置不完整 → 系统提示缺少项并阻止发布  

##### AC3：发布成功
- Given 智能体配置完整  
- When 用户确认发布  
- Then 系统将智能体状态更新为 `published`  
- And 跳转回智能体详情页或列表  
- And 提示“发布成功”  

---

### US-018：智能体对话（P2）
**作为** 一个用户  
**我想要** 与已发布的智能体进行对话  
**以便于** 获得 AI 助手提供的回答与帮助  

#### ✔ 验收标准：

##### AC1：对话已发布的智能体
- Given 用户选择一个状态为 `published` 的智能体  
- When 用户进入对话界面  
- Then 系统展示输入框与历史聊天记录（如有）  

##### AC2：执行模型推理 / RAG / 工作流
- Given 用户输入问题并提交  
- When 系统处理该问题  
- Then 按智能体配置执行对应流程：  
  - 若绑定知识库 → 执行 RAG 检索  
  - 若绑定工作流 → 执行工作流  
  - 若只配置模型 → 直接调用模型生成回复  

##### AC3：返回回答
- Given 智能体执行成功  
- When 系统生成最终回答  
- Then 回答展示在对话窗口中  

##### AC4：失败情况处理
- Given 执行过程中发生错误  
- When 系统返回错误信息  
- Then 对话窗口展示错误提示，例如：  
  - “模型调用失败：xxx”  
  - “工作流执行失败（节点 XXX）”  
  - “检索服务超时”  

## 👤 用户管理模块

---

### US-019：用户注册（P0）
**作为** 一个用户  
**我想要** 注册一个新账号  
**以便于** 使用系统全部功能  

#### ✔ 验收标准：

##### AC1：注册信息提交
- Given 用户输入用户名、邮箱与密码  
- When 点击“注册”  
- Then 系统验证邮箱格式、密码强度、唯一性  

##### AC2：注册成功
- Given 信息合法  
- When 注册完成  
- Then 系统创建账号并发送邮箱验证链接  

##### AC3：注册失败提示
- Given 信息不符合规则（如邮箱重复或密码过弱）  
- When 用户提交  
- Then 系统提示具体错误原因  

---

### US-020：用户登录（P0）
**作为** 一个用户  
**我想要** 登录系统  
**以便于** 访问个人账号和功能  

#### ✔ 验收标准：

##### AC1：账号密码登录
- Given 用户输入邮箱或用户名与密码  
- When 信息正确  
- Then 登录成功并跳转到首页  

##### AC2：失败处理
- Given 密码错误  
- When 登录失败  
- Then 系统提示“账号或密码错误”  

##### AC3：安全限制
- Given 多次失败  
- When 登录失败次数达到上限（如 5 次）  
- Then 账户被临时锁定  

---

### US-021：编辑个人资料（P0）
**作为** 一个用户  
**我想要** 查看与修改个人资料  
**以便于** 保持账号信息准确  

#### ✔ 验收标准：

##### AC1：查看资料
- Given 用户已登录  
- When 打开“个人中心”  
- Then 显示昵称、邮箱、头像等资料  

##### AC2：编辑资料
- Given 用户修改头像、昵称或简介  
- When 点击“保存”  
- Then 系统更新用户信息  

##### AC3：修改密码
- Given 用户输入旧密码和新密码  
- When 符合安全要求  
- Then 系统更新密码  

## 🛠️ 系统管理模块

---

### US-022：配置模型与系统参数（P0）
**作为** 一个管理员  
**我想要** 配置系统关键参数（例如可用模型列表与 API Key）  
**以便于** 系统正常运行  

#### ✔ 验收标准：

##### AC1：修改系统参数
- Given 管理员进入模型管理页面  
- When 新增、编辑或删除模型配置（API Key、模型名称、权重、可用性）  
- Then 系统保存修改  

##### AC2：查看更新结果
- Given 更新成功  
- When 返回模型列表页面  
- Then 加载最新模型配置并展示  

---

### US-023：查看系统运行日志（P1）
**作为** 一个管理员  
**我想要** 查看系统运行日志  
**以便于** 在出现问题时快速定位原因  

#### ✔ 验收标准：

##### AC1：查询日志
- Given 管理员选择时间范围  
- When 系统加载日志  
- Then 展示该时间段的工作流执行日志  

##### AC2：按模块过滤
- Given 管理员选择“插件调用”、“智能体执行”等模块  
- When 搜索或筛选  
- Then 展示符合条件的日志记录  

##### AC3：导出日志
- Given 管理员点击“导出”  
- When 系统生成文件  
- Then 管理员可下载 CSV 文件  

## 🔒 非功能性需求

### 性能要求
- 工作流执行 < **3 秒**
- RAG 检索 < **300ms**

### 安全要求
- API Key 加密处理
- 限制文件上传格式
- 限制模型调用频率（Rate Limit）

### 可维护性
- 模块化代码结构
- 统一日志体系
- 配置参数独立化管理（配置中心可选）

---

# 📦 6. 验收标准总结（Checklist）

- [ ] 所有模块具备可运行能力  
- [ ] 智能体可创建、编辑、执行  
- [ ] 工作流可视化编辑正常运行  
- [ ] RAG 检索准确且可执行  
- [ ] 插件可注册并能调用真实 API  
- [ ] 全流程完成部署（Docker）  
- [ ] 文档完整（需求 / 接口 / 部署 / 测试）

---

# 🔔 7. 优先级划分

## P0（必须实现）
### 智能体管理
- US-001：创建智能体  
- US-002：查看智能体列表  
- US-003：编辑智能体  
- US-004：测试智能体  
- US-005：删除智能体  

### 知识库管理
- US-007：上传文档并构建向量  
- US-010：删除知识库  

### 用户管理
- US-019：用户注册  
- US-020：用户登录  
- US-021：编辑个人资料  

### 系统管理
- US-022：配置模型与系统参数  

---

## P1（重要功能）
### 知识库管理
- US-006：创建知识库  
- US-008：查看知识库文档  
- US-009：RAG 检索  

### 工作流管理
- US-011：创建工作流（拖拽编排）  
- US-012：执行完整工作流  
- US-013：调试单节点  

### 系统管理
- US-023：查看系统日志  

---

## P2（增强功能）
### 插件管理
- US-014：注册插件  
- US-015：启用 / 禁用插件  
- US-016：在工作流中调用插件  

### 智能体综合功能
- US-017：发布智能体  
- US-018：智能体对话  

---

# 🎯 8. 用户故事到数据库设计的映射

- 📌 Agent（智能体）：US-001、002、003、004、005、017、018  
- 📌 KnowledgeBase（知识库）：US-006 ~ US-010  
- 📌 Document（文档&向量块）：US-007 ~ US-010  
- 📌 Workflow（工作流）：US-011 ~ US-013  
- 📌 Plugin（插件）：US-014 ~ US-016  
- 📌 User（用户）：US-019 ~ US-021  
- 📌 SystemConfig（系统配置）：US-022  
- 📌 SystemLog（系统日志）：US-023

