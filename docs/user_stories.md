# 📘 用户故事（User Stories）

## 🤖 智能体管理模块

---

### US-001：创建智能体（P0）
**作为** 一个用户  
**我想要** 创建一个新的智能体  
**以便于** 使用AI助手完成自定义任务  

#### ✔ 验收标准 (Acceptance Criteria)：

##### AC1：创建智能体
- Given 用户已打开创建智能体页面  
- When 用户填写智能体名称、描述、选择绑定的工作流与知识库并提交  
- Then 系统创建智能体并保存到数据库，返回创建成功的智能体信息  

##### AC2：错误提示
- Given 用户未填写必填项  
- When 用户点击提交  
- Then 系统提示缺失项并阻止创建  

##### AC3：成功提示
- Given 创建成功  
- When 用户返回智能体列表  
- Then 新建的智能体会显示在列表中  

---

### US-002：查看智能体列表（P0）
**作为** 一个用户  
**我想要** 查看我创建的所有智能体列表  
**以便于** 管理和选择要使用的智能体  

#### ✔ 验收标准：

##### AC1：加载列表
- Given 用户已登录系统  
- When 用户访问智能体列表页面  
- Then 系统显示该用户创建的所有智能体  
- And 包含名称、描述、状态、更新时间等基本信息  

##### AC2：错误提示
- Given 系统无法加载列表（网络异常、后端错误）  
- When 用户打开智能体列表页面  
- Then 系统明确提示错误信息  

##### AC3：成功提示
- Given 用户之前创建过智能体并已保存  
- When 系统加载列表  
- Then 数据应为最新保存内容  

---

### US-003：编辑智能体（P0）
**作为** 一个普用户  
**我想要** 编辑已创建的智能体信息  
**以便于** 更新智能体的配置与提示词，使其保持最佳效果  

#### ✔ 验收标准：

##### AC1：进入编辑页面
- Given 用户已登录且该智能体属于该用户  
- When 用户进入智能体编辑页面  
- Then 系统加载智能体当前配置（名称、描述、提示词、绑定的知识库、绑定的工作流等）  

##### AC2：编辑并保存成功
- Given 用户修改名称、描述、提示词或绑定资源  
- When 用户点击保存  
- Then 系统保存更新的配置  
- And 更新智能体的修改时间  

##### AC3：再次打开依然正确
- Given 用户之前成功保存智能体更改  
- When 用户再次打开编辑页面  
- Then 系统显示最新保存的数据  

##### AC4：保存失败提示
- Given 编辑发生错误（如字段不合法、后台保存失败）  
- When 用户点击保存  
- Then 系统明确提示错误原因  

---

### US-004：测试智能体（P0）
**作为** 一个用户  
**我想要** 测试智能体的回答效果  
**以便于** 验证智能体的配置、提示词和工作流是否正确工作  

#### ✔ 验收标准：

##### AC1：进入测试界面
- Given 用户已创建智能体  
- When 用户进入智能体详情或测试页面  
- Then 系统展示测试输入框与测试历史（如有）  

##### AC2：执行智能体
- Given 用户输入测试问题  
- When 用户提交  
- Then 系统调用智能体绑定的工作流 / 模型配置执行  
- And 将执行过程的最终答案展示给用户  

##### AC3：执行失败
- Given 执行失败（如模型调用失败、工作流错误）  
- When 系统返回结果  
- Then 系统显示明确的失败原因  

##### AC4：执行成功
- Given 系统执行完成  
- When 返回结果  
- Then 界面展示完整的执行输出（模型回答、引用知识库、工作流产物等）  

---

### US-005：删除智能体（P0）
**作为** 一个用户  
**我想要** 删除我已创建的智能体  
**以便于** 移除不再使用或测试用的智能体，保持列表清晰  

#### ✔ 验收标准：

##### AC1：只能删除自己的智能体
- Given 用户已登录  
- And 系统中存在该用户创建的智能体  
- When 用户点击“删除”按钮  
- Then 系统允许删除操作  
- And 不允许删除其他用户创建的智能体  

##### AC2：删除前确认提示
- Given 用户点击删除按钮  
- When 系统弹出确认框  
- Then 用户必须确认一次  
- And 提示内容包含“删除后不可恢复”的警告  

##### AC3：删除成功
- Given 用户在确认框中点击“确认删除”  
- When 系统完成删除操作  
- Then 智能体从列表中移除  
- And 前端刷新为最新列表  
- And 系统提示“删除成功”  

##### AC4：删除失败提示
- Given 后端删除失败（如数据库错误、网络错误）  
- When 用户尝试删除  
- Then 系统提示明确错误原因  
- And 智能体仍保留在列表中  

##### AC5：级联影响检查
- Given 智能体绑定了知识库/工作流

## 📤 知识库管理模块

---

### US-006：创建知识库（P1）
**作为** 一个用户  
**我想要** 创建一个新的知识库  
**以便于** 存储和管理文档资料，为智能体提供知识来源  

#### ✔ 验收标准：

##### AC1：创建成功
- Given 一个用户已登录系统  
- When 用户填写知识库名称和描述并点击“创建”  
- Then 系统成功创建知识库并写入数据库  
- And 新知识库显示在知识库列表中  

##### AC2：必填项校验
- Given 用户未填写知识库名称（必填）  
- When 用户点击“创建”  
- Then 系统阻止创建并提示“名称不能为空”  

##### AC3：发生错误
- Given 后端创建知识库时出现错误（如数据库异常）  
- When 用户点击“创建”  
- Then 系统提示“创建失败”及原因说明  

---

### US-007：上传文档到知识库并构建向量（P0）
**作为** 一个用户  
**我想要** 上传 TXT 或 Markdown 文档到知识库  
**以便于** 构建知识库并支持 RAG 检索  

#### ✔ 验收标准：

##### AC1：上传格式正确
- Given 一个用户已创建知识库  
- When 用户选择 TXT 或 Markdown 文件并点击“上传”  
- Then 系统验证格式通过并接收文件  

##### AC2：文件过大
- Given 用户选择的文件超过系统大小限制  
- When 用户上传文件  
- Then 系统拒绝上传并提示“文件大小超出限制”  

##### AC3：格式错误
- Given 用户选择的文件不是 TXT 或 Markdown（如 PDF、DOCX）  
- When 用户上传  
- Then 系统拒绝并提示“文件格式不支持”  

##### AC4：文件处理（分块 + 向量化）
- Given 文档成功上传  
- When 系统后台处理文件  
- Then 文档被分块并向量化  
- And 文档状态从“处理中”更新为“已完成”或“失败”  

##### AC5：上传记录可见
- Given 文档处理已结束  
- When 用户进入该知识库的文档列表页面  
- Then 用户可以看到该文档的文件名、上传时间、处理状态  

---

### US-008：查看知识库文档（P1）
**作为** 一个用户  
**我想要** 查看知识库中的文档列表  
**以便于** 了解当前知识库的内容与处理状态  

#### ✔ 验收标准：

##### AC1：展示文档列表
- Given 一个用户已创建知识库  
- When 用户进入知识库详情页面  
- Then 系统显示该知识库下所有文档  
- And 展示文件名、上传时间、处理状态  

##### AC2：空列表情况
- Given 知识库中暂无任何文档  
- When 用户进入知识库详情页面  
- Then 系统显示“暂无文档”提示  
- And 引导用户上传文档  

##### AC3：处理状态更新
- Given 某些文档仍在处理中  
- When 用户刷新或重新进入页面  
- Then 系统展示最新的处理状态（如由处理中变为完成）  

---

### US-009：RAG 检索（P1）
**作为** 一个用户  
**我想要** 基于知识库执行 RAG 检索  
**以便于** 获取与问题最相关的文档内容  

#### ✔ 验收标准：

##### AC1：发起检索  
- Given 一个用户已有至少一个包含已处理文档的知识库  
- When 用户输入查询问题并点击“检索”  
- Then 系统对知识库向量进行相似度检索  

##### AC2：返回检索结果
- Given 检索有匹配内容  
- When 系统返回结果  
- Then 系统展示文档片段内容、所属文档、相似度评分  

##### AC3：无匹配
- Given 检索未找到足够相似内容  
- When 系统返回结果  
- Then 系统提示“未检索到相关内容”  

##### AC4：性能要求
- Given 系统处于正常负载下  
- When 用户发起检索  
- Then 检索结果应在约 300ms（或可接受时间）内返回  

##### AC5：错误处理
- Given RAG 服务或向量服务异常  
- When 用户点击“检索”  
- Then 系统提示“检索失败”及简要原因  

---

### US-010：删除知识库（P0）
**作为** 一个用户  
**我想要** 删除已创建的知识库  
**以便于** 移除不再需要的知识库，保持资源整洁  

#### ✔ 验收标准：

##### AC1：只能删除自己的知识库
- Given 一个用户已登录  
- And 该知识库由该用户创建  
- When 用户点击“删除知识库”按钮  
- Then 系统允许继续执行删除操作  

##### AC2：删除前确认提示
- Given 用户点击“删除知识库”  
- When 系统弹出确认框  
- Then 系统提示“删除后不可恢复，且文档与向量将被一起删除”  
- And 用户需要手动确认删除  

##### AC3：删除成功
- Given 用户在确认框内点击“确认删除”  
- When 系统执行删除逻辑  
- Then 系统删除该知识库  
- And 删除其下所有文档与对应向量  
- And 知识库立即从知识库列表中移除  
- And 系统提示“删除成功”  

##### AC4：删除失败提示
- Given 删除过程中出现后端错误（如数据库错误、向量库操作错误）  
- When 用户执行删除操作  
- Then 系统提示“删除失败”并显示简要原因  
- And 知识库保持原状，不被删除  

##### AC5：与智能体的绑定处理
- Given 知识库仍被一个或多个智能体绑定  
- When 用户尝试删除该知识库  
- Then 系统阻止删除  
- And 提示“该知识库正在被 X 个智能体使用，无法删除”  
- (Optional) 引导用户前往智能体管理中解除绑定  

## 🔧 工作流管理模块

---

### US-011：创建工作流（可视化拖拽编排）（P1）
**作为** 一个用户  
**我想要** 通过可视化拖拽节点创建工作流  
**以便于** 直观地定义智能体的执行流程  

#### ✔ 验收标准：

##### AC1：拖拽添加节点
- Given 一个用户已登录并打开工作流编辑画布  
- When 用户拖拽节点（如 Start、LLM、Condition、Plugin、Output）到画布  
- Then 系统在画布中显示对应节点  

##### AC2：节点连线
- Given 画布上已有多个节点  
- When 用户拖拽连线连接两个节点  
- Then 系统更新流程结构并显示连接关系  

##### AC3：节点或连线删除
- Given 用户选中一个节点或连线  
- When 用户执行删除操作  
- Then 系统立即更新流程结构并从画布移除该元素  

##### AC4：配置节点参数
- Given 用户点击任意节点  
- When 用户填写或修改该节点的参数（如 LLM 配置、插件参数、分支条件）  
- Then 系统保存该节点的配置到工作流结构中（暂存）  

##### AC5：保存工作流（含 DAG 验证）
- Given 用户已完成工作流编排  
- When 用户点击“保存工作流”  
- Then 系统校验流程合法性（包括 DAG 拓扑结构验证，不允许循环）  
- And 验证通过后工作流结构被持久化  
- And 若验证失败，则提示“流程结构存在循环或错误”  

---

### US-012：执行完整工作流（P1）
**作为** 一个用户  
**我想要** 执行整个工作流  
**以便于** 测试最终的执行效果  

#### ✔ 验收标准：

##### AC1：运行工作流
- Given 一个用户已创建并保存工作流  
- When 用户点击“执行工作流”  
- Then 系统按照工作流定义，从 Start 节点开始依序执行所有节点  

##### AC2：执行成功
- Given 所有节点均执行成功  
- When 工作流执行结束  
- Then 系统展示 Output 节点的最终输出结果  

##### AC3：节点执行失败
- Given 某个节点执行失败  
- When 工作流执行中断  
- Then 系统提示失败节点的名称  
- And 提示失败原因（如参数错误、模型调用失败、插件异常）  

##### AC4：查看执行状态
- Given 工作流正在执行  
- When 系统更新执行进度  
- Then 用户可看到 pending / running / completed / failed 等状态  

---

### US-013：调试单个节点（P1）
**作为** 一个用户  
**我想要** 单独调试某个节点  
**以便于** 在复杂工作流中快速定位问题  

#### ✔ 验收标准：

##### AC1：选择节点调试
- Given 用户在工作流编辑器中选中某个节点  
- When 点击“调试节点”  
- Then 系统展示节点所需输入参数（示例输入或用户自行输入）  

##### AC2：调试执行
- Given 用户填写调试输入  
- When 点击“开始调试”  
- Then 系统仅执行该节点的逻辑  
- And 展示该节点的输出结果  

##### AC3：不影响正式工作流配置
- Given 单节点调试已经完成  
- When 调试结束  
- Then 系统不会修改工作流正式配置  
- And 不会改变工作流整体的运行逻辑  

## 🔌 插件管理模块

---

### US-014：注册插件（P2）
**作为** 一个用户  
**我想要** 注册一个自定义插件  
**以便于** 扩展智能体的功能  

#### ✔ 验收标准：

##### AC1：输入 OpenAPI 规范地址（URL 或 JSON 文件）
- Given 一个用户已登录系统  
- When 用户输入 openapi.json URL 或上传 OpenAPI JSON 文件并点击“提交”  
- Then 系统读取 OpenAPI 内容并尝试解析 API 结构  

##### AC2：OpenAPI 格式正确
- Given OpenAPI 规范格式正确  
- When 系统解析成功  
- Then 系统展示 API 的基础信息与接口列表  
- And 用户可以填写插件名称、描述、鉴权配置等信息  

##### AC3：OpenAPI 格式错误
- Given OpenAPI 格式不正确或解析失败  
- When 用户提交解析  
- Then 系统提示“OpenAPI 格式错误”  

##### AC4：注册成功
- Given 用户已填写插件名称和描述  
- When 用户点击“保存插件”  
- Then 系统保存插件定义  
- And 返回插件管理页面  
- And 插件出现在插件列表中  

---

### US-015：启用 / 禁用插件（P2）
**作为** 一个用户  
**我想要** 启用或禁用已注册的插件  
**以便于** 控制插件是否可在工作流中使用  

#### ✔ 验收标准：

##### AC1：切换插件状态
- Given 一个用户已注册插件  
- When 用户在插件管理界面切换启用 / 禁用状态  
- Then 系统更新插件的启用状态  

##### AC2：禁用插件
- Given 插件处于禁用状态  
- When 用户在工作流编辑器中配置插件节点  
- Then 禁用的插件不会出现在可用插件接口列表中  

##### AC3：启用插件
- Given 插件处于启用状态  
- When 用户打开插件节点配置  
- Then 插件接口出现在可选列表中并可正常使用  

---

### US-016：在工作流中调用插件（P2）
**作为** 一个用户  
**我想要** 在工作流中调用插件  
**以便于** 扩展智能体的能力并调用外部 API  

#### ✔ 验收标准：

##### AC1：配置插件节点
- Given 用户在工作流编辑器中选择插件节点  
- When 用户从列表中选择一个已启用的插件接口  
- Then 系统将该节点绑定到插件接口定义  

##### AC2：插件调用成功
- Given 工作流执行到插件节点  
- When 插件 API 调用成功  
- Then 系统返回插件执行结果  
- And 节点输出可继续传入下游节点  
- And 若整个工作流执行完成  
- Then 插件结果体现在最终输出中  

##### AC3：插件调用失败
- Given 插件调用出现错误（如鉴权失败、超时、API 报错）  
- When 工作流执行该插件节点  
- Then 系统提示明确的错误原因  
- And 工作流执行失败并中断后续节点  

## 🧩 综合功能模块

---

### US-017：发布智能体（P2）
**作为** 一个用户  
**我想要** 发布已创建的智能体  
**以便于** 让智能体可以被正式使用  

#### ✔ 验收标准：

##### AC1：发布智能体
- Given 一个用户已创建一个智能体且其状态为 draft  
- When 用户点击“发布”按钮  
- Then 系统开始执行发布前的配置验证  

##### AC2：配置完整性校验
- Given 用户发起发布流程  
- When 系统检查智能体配置（如名称、提示词、模型配置、知识库、绑定工作流等）  
- Then 若配置完整 → 系统通过校验  
- And 若配置不完整 → 系统提示缺少项并阻止发布  

##### AC3：发布成功
- Given 智能体配置完整  
- When 用户确认发布  
- Then 系统将智能体状态更新为 `published`  
- And 跳转回智能体详情页或列表  
- And 提示“发布成功”  

---

### US-018：智能体对话（P2）
**作为** 一个用户  
**我想要** 与已发布的智能体进行对话  
**以便于** 获得 AI 助手提供的回答与帮助  

#### ✔ 验收标准：

##### AC1：对话已发布的智能体
- Given 用户选择一个状态为 `published` 的智能体  
- When 用户进入对话界面  
- Then 系统展示输入框与历史聊天记录（如有）  

##### AC2：执行模型推理 / RAG / 工作流
- Given 用户输入问题并提交  
- When 系统处理该问题  
- Then 按智能体配置执行对应流程：  
  - 若绑定知识库 → 执行 RAG 检索  
  - 若绑定工作流 → 执行工作流  
  - 若只配置模型 → 直接调用模型生成回复  

##### AC3：返回回答
- Given 智能体执行成功  
- When 系统生成最终回答  
- Then 回答展示在对话窗口中  

##### AC4：失败情况处理
- Given 执行过程中发生错误  
- When 系统返回错误信息  
- Then 对话窗口展示错误提示，例如：  
  - “模型调用失败：xxx”  
  - “工作流执行失败（节点 XXX）”  
  - “检索服务超时”  

## 👤 用户管理模块

---

### US-019：用户注册（P0）
**作为** 一个用户  
**我想要** 注册一个新账号  
**以便于** 使用系统全部功能  

#### ✔ 验收标准：

##### AC1：注册信息提交
- Given 用户输入用户名、邮箱与密码  
- When 点击“注册”  
- Then 系统验证邮箱格式、密码强度、唯一性  

##### AC2：注册成功
- Given 信息合法  
- When 注册完成  
- Then 系统创建账号并发送邮箱验证链接  

##### AC3：注册失败提示
- Given 信息不符合规则（如邮箱重复或密码过弱）  
- When 用户提交  
- Then 系统提示具体错误原因  

---

### US-020：用户登录（P0）
**作为** 一个用户  
**我想要** 登录系统  
**以便于** 访问个人账号和功能  

#### ✔ 验收标准：

##### AC1：账号密码登录
- Given 用户输入邮箱或用户名与密码  
- When 信息正确  
- Then 登录成功并跳转到首页  

##### AC2：失败处理
- Given 密码错误  
- When 登录失败  
- Then 系统提示“账号或密码错误”  

##### AC3：安全限制
- Given 多次失败  
- When 登录失败次数达到上限（如 5 次）  
- Then 账户被临时锁定  

---

### US-021：编辑个人资料（P0）
**作为** 一个用户  
**我想要** 查看与修改个人资料  
**以便于** 保持账号信息准确  

#### ✔ 验收标准：

##### AC1：查看资料
- Given 用户已登录  
- When 打开“个人中心”  
- Then 显示昵称、邮箱、头像等资料  

##### AC2：编辑资料
- Given 用户修改头像、昵称或简介  
- When 点击“保存”  
- Then 系统更新用户信息  

##### AC3：修改密码
- Given 用户输入旧密码和新密码  
- When 符合安全要求  
- Then 系统更新密码  

## 🛠️ 系统管理模块

---

### US-022：配置模型与系统参数（P0）
**作为** 一个管理员  
**我想要** 配置系统关键参数（例如可用模型列表与 API Key）  
**以便于** 系统正常运行  

#### ✔ 验收标准：

##### AC1：修改系统参数
- Given 管理员进入模型管理页面  
- When 新增、编辑或删除模型配置（API Key、模型名称、权重、可用性）  
- Then 系统保存修改  

##### AC2：查看更新结果
- Given 更新成功  
- When 返回模型列表页面  
- Then 加载最新模型配置并展示  

---

### US-023：查看系统运行日志（P1）
**作为** 一个管理员  
**我想要** 查看系统运行日志  
**以便于** 在出现问题时快速定位原因  

#### ✔ 验收标准：

##### AC1：查询日志
- Given 管理员选择时间范围  
- When 系统加载日志  
- Then 展示该时间段的工作流执行日志  

##### AC2：按模块过滤
- Given 管理员选择“插件调用”、“智能体执行”等模块  
- When 搜索或筛选  
- Then 展示符合条件的日志记录  

##### AC3：导出日志
- Given 管理员点击“导出”  
- When 系统生成文件  
- Then 管理员可下载 CSV 文件  

## 🔒 非功能性需求

### 性能要求
- 工作流执行 < **3 秒**
- RAG 检索 < **300ms**

### 安全要求
- API Key 加密处理
- 限制文件上传格式
- 限制模型调用频率（Rate Limit）

### 可维护性
- 模块化代码结构
- 统一日志体系
- 配置参数独立化管理（配置中心可选）

---